<script>
    let money = localStorage.getItem("money") ? parseInt(localStorage.getItem("money")) : 100;
    let blackjackUnlocked = localStorage.getItem("blackjackUnlocked") === "true";
    let autoSpinnerActive = localStorage.getItem("autoSpinner") === "true";

    document.getElementById("money").innerText = money;

    if (blackjackUnlocked) {
        document.getElementById("blackjack-arrow").style.display = "block";
    }

    function createSlotMachine() {
        let machine = document.createElement("div");
        machine.className = "machine";
        machine.innerHTML = `
            <div class="slots">
                <span class="slot">‚ùì</span>
                <span class="slot">‚ùì</span>
                <span class="slot">‚ùì</span>
            </div>
            <button class="spin-btn">Spin ($10)</button>
        `;

        document.getElementById("machines").appendChild(machine);
        machine.querySelector(".spin-btn").addEventListener("click", () => spinMachine(machine));
    }

    function spinMachine(machine) {
        if (money < 10) {
            document.getElementById("message").innerText = "Not enough money!";
            return;
        }

        money -= 10;
        updateMoney();

        let slots = machine.querySelectorAll(".slot");
        let symbols = ["üçí", "üçã", "üîî", "‚≠ê", "7Ô∏è‚É£"];
        let result = [];

        let forceWin = Math.random() < 0.5; // 50% win rate

        if (forceWin) {
            let winSymbol = symbols[Math.floor(Math.random() * symbols.length)];
            slots.forEach(slot => slot.innerText = winSymbol);
            result = [winSymbol, winSymbol, winSymbol];
        } else {
            slots.forEach(slot => {
                let symbol = symbols[Math.floor(Math.random() * symbols.length)];
                slot.innerText = symbol;
                result.push(symbol);
            });
        }

        if (result[0] === result[1] && result[1] === result[2]) {
            let winnings = 50;
            money += winnings;
            document.getElementById("message").innerText = "You won $" + winnings + "!";
        } else {
            document.getElementById("message").innerText = "Try again!";
        }

        updateMoney();
    }

    document.getElementById("buy-machine-btn").addEventListener("click", function () {
        if (money >= 50) {
            money -= 50;
            updateMoney();
            createSlotMachine();
            document.getElementById("message").innerText = "Bought a new slot machine!";
        } else {
            document.getElementById("message").innerText = "Not enough money!";
        }
    });

    document.getElementById("buy-auto-spinner-btn").addEventListener("click", function () {
        if (money >= 30) {
            money -= 30;
            updateMoney();
            autoSpinnerActive = true;
            localStorage.setItem("autoSpinner", "true");
            document.getElementById("message").innerText = "Bought an auto spinner!";
        } else {
            document.getElementById("message").innerText = "Not enough money!";
        }
    });

    document.getElementById("unlock-blackjack-btn").addEventListener("click", function () {
        if (money >= 2500) {
            money -= 2500;
            updateMoney();
            blackjackUnlocked = true;
            localStorage.setItem("blackjackUnlocked", "true");
            document.getElementById("blackjack-arrow").style.display = "block";
            document.getElementById("message").innerText = "Blackjack Unlocked!";
        } else {
            document.getElementById("message").innerText = "Not enough money!";
        }
    });

    function updateMoney() {
        document.getElementById("money").innerText = money;
        localStorage.setItem("money", money);
    }

    document.getElementById("settings-icon").addEventListener("click", function () {
        let menu = document.getElementById("settings-menu");
        menu.style.display = (menu.style.display === "block") ? "none" : "block";
    });

    document.getElementById("reset-save").addEventListener("click", function () {
        localStorage.clear();
        location.reload();
    });

    if (autoSpinnerActive) {
        setInterval(() => {
            document.querySelectorAll(".machine").forEach(machine => spinMachine(machine));
        }, 3000);
    }
</script>
